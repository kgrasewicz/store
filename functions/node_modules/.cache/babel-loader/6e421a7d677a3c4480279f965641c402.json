{"ast":null,"code":"import _classCallCheck from\"C:/Programowanie/store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Programowanie/store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:/Programowanie/store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:/Programowanie/store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Programowanie/store/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import axios from\"axios\";import{withRouter,NavLink}from\"react-router-dom\";import $ from\"jquery\";import InputForm from\"./InputForm\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Checkout=/*#__PURE__*/function(_Component){_inherits(Checkout,_Component);var _super=_createSuper(Checkout);function Checkout(props){var _this;_classCallCheck(this,Checkout);_this=_super.call(this,props);_this._isMounted=false;_this.componentDidMount=function(){_this.fetchData();_this.sendGetRequest();};_this.componentDidUpdate=function(prevProps,prevState){if(prevProps.match.params.step!==_this.props.match.params.step){console.log(\"adfasf\");_this._isMounted=true;setTimeout(function(){_this.fetchData();_this.sendGetRequest();_this.setState({step:_this.props.match.params.step});},100);}};_this.sendGetRequest=function(){_this._isMounted=true;axios.get(\"/api/users/getUser\",{withCredentials:true}).then(function(response){console.log(response);$('.checkout__form__name input[name=\"fname\"]').val(response.data.fname);$('.checkout__form__surname input[name=\"lname\"]').val(response.data.lname);$('.checkout__form__email input[name=\"email\"]').val(response.data.username);$('.checkout__form__name input[name=\"fname\"]').prop(\"disabled\",true);$('.checkout__form__surname input[name=\"lname\"]').prop(\"disabled\",true);$('.checkout__form__email input[name=\"email\"]').prop(\"disabled\",true);}).catch(function(error){console.log(error);});};_this.fetchData=function(){axios.get(\"/api/cart\").then(function(response){if(_this._isMounted){_this.setState({cart:response.data},_this.autocompletePast.bind(_assertThisInitialized(_this)));_this._isMounted=false;$(\".items-counter\").text(response.data.itemsTotal);}}).catch(function(error){console.log(error);});};_this.autocompletePast=function(){if(_this.state.cart.personalData!==undefined){console.log(_this.state.cart.personalData.firstName);$('.checkout__form__name input[name=\"fname\"]').val(_this.state.cart.personalData.firstName);$('.checkout__form__surname input[name=\"lname\"]').val(_this.state.cart.personalData.lastName);$('.checkout__form__email input[name=\"email\"]').val(_this.state.cart.personalData.email);$('.checkout__form__phone input[name=\"phone\"]').val(_this.state.cart.personalData.phone);$('.checkout__form__country input[name=\"country\"]').val(_this.state.cart.personalData.country);$('.checkout__form__code input[name=\"postal-code\"]').val(_this.state.cart.personalData.postalCode);$('.checkout__form__city input[name=\"address-level2\"]').val(_this.state.cart.personalData.city);$('.checkout__form__address-line1 input[name=\"address-line1\"]').val(_this.state.cart.personalData.addressLine1);$('.checkout__form__address-line2 input[name=\"address-line2\"]').val(_this.state.cart.personalData.addressLine2);}if(_this.state.cart.shippingDetails!==undefined&&_this.state.step==\"2\"){document.querySelector(\"input[value=\\\"\".concat(_this.state.cart.shippingDetails.method,\"\\\"\")).click();if(_this.state.cart.shippingDetails.method!==\"Parcel Locker InPost\"){for(var i=0;i<_this.state.cart.shippingDetails.address.split(\",\").length;i++){document.querySelectorAll(\".else input\")[i].value=_this.state.cart.shippingDetails.address.split(\",\")[i];}}else{for(var i=0;i<_this.state.cart.shippingDetails.address.split(\",\").length;i++){document.querySelectorAll(\".inpost input\")[i].value=_this.state.cart.shippingDetails.address.split(\",\")[i];}}}};_this.handleShipAddressToggle=function(){if($(\".switch input\").is(\":checked\")){$('.checkout__form__shipping__country input[name=\"country\"]').val(_this.state.cart.personalData.country);$('.checkout__form__shipping__code input[name=\"postal-code\"]').val(_this.state.cart.personalData.postalCode);$('.checkout__form__shipping__city input[name=\"address-level2\"]').val(_this.state.cart.personalData.city);$('.checkout__form__shipping__address-line1 input[name=\"address-line1\"]').val(_this.state.cart.personalData.addressLine1);$('.checkout__form__shipping__address-line2 input[name=\"address-line2\"]').val(_this.state.cart.personalData.addressLine2);}else{$('.checkout__form__shipping__country input[name=\"country\"]').val(\"\");$('.checkout__form__shipping__code input[name=\"postal-code\"]').val(\"\");$('.checkout__form__shipping__city input[name=\"address-level2\"]').val(\"\");$('.checkout__form__shipping__address-line1 input[name=\"address-line1\"]').val(\"\");$('.checkout__form__shipping__address-line2 input[name=\"address-line2\"]').val(\"\");}};_this.postPersonalData=function(){axios.post(\"/api/cart/post-personal-data\",{id:_this.state.cart._id,firstName:$('input[name=\"fname\"]').val(),lastName:$('input[name=\"lname\"]').val(),email:$('input[name=\"email\"]').val(),phone:$('input[name=\"phone\"]').val(),country:$('input[name=\"country\"]').val(),postalCode:$('input[name=\"postal-code\"]').val(),city:$('input[name=\"address-level2\"]').val(),addressLine1:$('input[name=\"address-line1\"]').val(),addressLine2:$('input[name=\"address-line2\"]').val()}).then(function(response){console.log(response.data);console.log(_this.state.cart._id);}).catch(function(error){console.log(error);});};_this.postShippingData=function(){var elseInputs=[];var inpostInputs=[];for(var i=1;i<document.querySelectorAll(\".else input\").length;i++){elseInputs.push(document.querySelectorAll(\".else input\")[i].value);}for(var i=0;i<document.querySelectorAll(\".inpost input\").length;i++){inpostInputs.push(document.querySelectorAll(\".inpost input\")[i].value);}axios.post(\"/api/cart/post-shipping-data\",{id:_this.state.cart._id,method:$(\"input[name='delivery']:checked\").val(),address:document.querySelector('input[value=\"Parcel Locker InPost\"]').checked==true?inpostInputs.join(\", \"):elseInputs.join(\", \"),price:$(\"input[name='delivery']:checked\").parent().next().next().text().slice(0,$(\"input[name='delivery']:checked\").parent().next().next().text().length-4)}).then(function(response){console.log(response.data);}).catch(function(error){console.log(error);});};_this.finalizePurchase=function(){_this.postPaymentData();sessionStorage.clear();};_this.emptyCart=function(){_this._isMounted=true;axios.delete(\"/api/cart/empty-cart\").then(function(response){if(response.data!=null&&response.data<1){response.data=response.data;}else{response.data=false;}_this.setState({cart:response.data});$(\".items-counter\").text(response.data.itemsTotal);console.log(response);}).catch(function(error){console.log(error);});console.log(\"empty clicked\");};_this.postPaymentData=function(){axios.post(\"/api/cart/post-payment-data\",{id:_this.state.cart._id,method:$(\"input[name='payment']:checked\").val()}).then(function(response){console.log(response.data);_this.postCart();}).catch(function(error){console.log(error);});};_this.postCart=function(){axios.post(\"/api/cart/post-cart-db\").then(function(response){if(_this._isMounted){_this.setState({cart:response.data},$(\".items-counter\").text(response.data.itemsTotal));}}).catch(function(error){console.log(error);});};_this.state={cart:[],step:_this.props.match.params.step,checked:\"\"};_this.props=props;return _this;}_createClass(Checkout,[{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;}},{key:\"render\",value:function render(){var _this2=this;var CartMapping=function CartMapping(){var cart={};if(_this2.state.cart!=null&&_this2.state.cart.length<1){_this2.state.cart=false;}if(_this2.state.cart){cart=_this2.state.cart.items.map(function(item){return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cart__info\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"cart__info__name\",children:item.productName}),/*#__PURE__*/_jsxs(\"h3\",{className:\"cart__info__desc\",children:[\"Model: \",item.model,\", Size: \",item.size]})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"cart__items\",children:item.quantity>1?item.quantity+\" items\":item.quantity+\" item\"}),/*#__PURE__*/_jsxs(\"h2\",{className:\"cart__total\",children:[item.price,\" PLN\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"cart__line\"})]},item.productId+item.size);});}else{cart=/*#__PURE__*/_jsx(\"li\",{className:\"cart-container__table__products__item__line__empty\",children:\"The cart is empty\"});}return cart;};var RenderInputInfo=function RenderInputInfo(props){if(_this2.state.cart!=null&&_this2.state.cart.length<1){_this2.state.cart=false;}if(_this2.state.cart){if(props.inputSection==\"1\"){if(_this2.state.cart.personalData){return/*#__PURE__*/_jsxs(\"div\",{className:\"past\",children:[/*#__PURE__*/_jsx(NavLink,{className:\"checkout__edit\",to:\"/shop/cart/checkout/1\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Edit\"})}),/*#__PURE__*/_jsxs(\"h3\",{children:[_this2.state.cart.personalData.firstName+\" \"+_this2.state.cart.personalData.lastName,\" \"]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Email: \",_this2.state.cart.personalData.email]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Phone: \",_this2.state.cart.personalData.phone]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Address:\",\" \",_this2.state.cart.personalData.city+\" \"+_this2.state.cart.personalData.postalCode+\", \"+_this2.state.cart.personalData.addressLine1+\" \"+_this2.state.cart.personalData.addressLine2+\", \"+_this2.state.cart.personalData.country]})]});}else{return/*#__PURE__*/_jsx(\"div\",{});}}else if(props.inputSection==\"2\"){if(_this2.state.cart.shippingDetails){return/*#__PURE__*/_jsxs(\"div\",{className:\"past\",children:[/*#__PURE__*/_jsx(NavLink,{className:\"checkout__edit\",to:\"/shop/cart/checkout/2\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Edit\"})}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Method: \",_this2.state.cart.shippingDetails.method]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Address: \",_this2.state.cart.shippingDetails.address]}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"Price: \",_this2.state.cart.shippingDetails.price,\" PLN\"]})]});}else{return/*#__PURE__*/_jsx(\"div\",{});}}else{return/*#__PURE__*/_jsx(\"div\",{children:_this2.state.cart.personalData.firstName});}}else{return/*#__PURE__*/_jsx(\"li\",{className:\"cart-container__table__products__item__line__empty\",children:\"The cart is empty\"});}};var InputSection=function InputSection(props){if(_this2.state.step==props.inputSection){return/*#__PURE__*/_jsx(InputForm,{status:_this2.state.loginStatus,section:\"checkout/\"+_this2.state.step,handler:props.handler,shipAddressHandler:_this2.handleShipAddressToggle,children:\" \"});}else if(_this2.state.step<props.inputSection){return/*#__PURE__*/_jsx(\"div\",{});}else{return/*#__PURE__*/_jsx(RenderInputInfo,{inputSection:props.inputSection});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"checkout\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"checkout__form\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"checkout__form__title\",children:\"checkout\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout__form__personal-data \"+(this.state.step==\"1\"?\"active\":\"\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"checkout__form__personal-data__tooltip\",children:/*#__PURE__*/_jsx(\"h4\",{className:\"checkout__form__personal-data__title\",children:\"1. Personal data\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"checkout__form__personal-data__content\",children:/*#__PURE__*/_jsx(InputSection,{handler:this.postPersonalData,inputSection:\"1\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout__form__delivery \"+(this.state.step==\"2\"?\"active\":\"\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"checkout__form__delivery__tooltip\",children:/*#__PURE__*/_jsx(\"h4\",{className:\"checkout__form__delivery__title\",children:\"2. Shipping details\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"checkout__form__delivery__content\",children:/*#__PURE__*/_jsx(InputSection,{handler:this.postShippingData,inputSection:\"2\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout__form__payment \"+(this.state.step==\"3\"?\"active\":\"\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"checkout__form__payment__tooltip\",children:/*#__PURE__*/_jsx(\"h4\",{className:\"checkout__form__payment__title\",children:\"3. Payment method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"checkout__form__payment__content\",children:/*#__PURE__*/_jsx(InputSection,{handler:this.finalizePurchase,inputSection:\"3\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout__summary\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"checkout__summary__title\",children:\"Items\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"checkout__summary__list\",children:/*#__PURE__*/_jsx(CartMapping,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout__summary__shipping\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"checkout__summary__shipping__title\",children:this.state.cart.shippingDetails?\"Shipping\":\"\"}),/*#__PURE__*/_jsxs(\"h2\",{className:\"checkout__summary__shipping__value\",children:[this.state.cart.shippingDetails?this.state.cart.shippingDetails.price+\"PLN\":\"\",\" \"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout__summary__total\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"checkout__summary__total__title\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"h2\",{className:\"checkout__summary__total__items\",children:[this.state.cart.itemsTotal||0,\" \",this.state.cart.itemsTotal==1?\"item\":\"items\"]}),/*#__PURE__*/_jsxs(\"h4\",{className:\"checkout__summary__total__value\",children:[+this.state.cart.subTotal+(this.state.cart.discountTotal||0)+ +(this.state.cart.shippingDetails?this.state.cart.shippingDetails.price:0),\" \",\"PLN\"]})]}),/*#__PURE__*/_jsx(NavLink,{className:\"checkout__summary__edit\",to:\"shop/cart\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Edit cart\"})})]})]});}}]);return Checkout;}(Component);export default withRouter(Checkout);","map":{"version":3,"sources":["C:/Programowanie/store/src/Components/Shop/Checkout.js"],"names":["React","Component","axios","withRouter","NavLink","$","InputForm","Checkout","props","_isMounted","componentDidMount","fetchData","sendGetRequest","componentDidUpdate","prevProps","prevState","match","params","step","console","log","setTimeout","setState","get","withCredentials","then","response","val","data","fname","lname","username","prop","catch","error","cart","autocompletePast","bind","text","itemsTotal","state","personalData","undefined","firstName","lastName","email","phone","country","postalCode","city","addressLine1","addressLine2","shippingDetails","document","querySelector","method","click","i","address","split","length","querySelectorAll","value","handleShipAddressToggle","is","postPersonalData","post","id","_id","postShippingData","elseInputs","inpostInputs","push","checked","join","price","parent","next","slice","finalizePurchase","postPaymentData","sessionStorage","clear","emptyCart","delete","postCart","CartMapping","items","map","item","productName","model","size","quantity","productId","RenderInputInfo","inputSection","InputSection","loginStatus","handler","subTotal","discountTotal"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport axios from \"axios\";\r\nimport { withRouter, NavLink } from \"react-router-dom\";\r\nimport $ from \"jquery\";\r\nimport InputForm from \"./InputForm\";\r\n\r\n\r\n\r\nclass Checkout extends Component {\r\n  _isMounted = false;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      cart: [],\r\n      step: this.props.match.params.step,\r\n      checked: \"\",\r\n    };\r\n\r\n    this.props = props;\r\n  }\r\n\r\n  componentDidMount = () => {    \r\n    this.fetchData();\r\n    this.sendGetRequest();\r\n  };\r\n\r\n  componentWillUnmount() {\r\n    this._isMounted = false;\r\n  }\r\n\r\n  componentDidUpdate = (prevProps, prevState) => {\r\n    if (prevProps.match.params.step !== this.props.match.params.step) {\r\n      console.log(\"adfasf\");\r\n      this._isMounted = true;      \r\n      setTimeout(() => {\r\n        this.fetchData();\r\n        this.sendGetRequest();\r\n        this.setState({ step: this.props.match.params.step });\r\n      },100)\r\n      \r\n      \r\n    }\r\n\r\n  };\r\n\r\n  sendGetRequest = () => {\r\n    this._isMounted = true;\r\n    axios\r\n      .get(\"/api/users/getUser\", {withCredentials: true})\r\n      .then((response) => {\r\n        console.log(response);\r\n        $('.checkout__form__name input[name=\"fname\"]').val(\r\n          response.data.fname\r\n        );\r\n        $('.checkout__form__surname input[name=\"lname\"]').val(\r\n          response.data.lname\r\n        );\r\n        $('.checkout__form__email input[name=\"email\"]').val(\r\n          response.data.username\r\n        );\r\n\r\n        $('.checkout__form__name input[name=\"fname\"]').prop( \"disabled\", true )\r\n        $('.checkout__form__surname input[name=\"lname\"]').prop( \"disabled\", true )\r\n        $('.checkout__form__email input[name=\"email\"]').prop( \"disabled\", true )\r\n\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  fetchData = () => {\r\n\r\n    axios\r\n      .get(\"/api/cart\")\r\n      .then((response) => {\r\n        if (this._isMounted) {\r\n          this.setState(\r\n            {\r\n              cart: response.data,\r\n            },\r\n            this.autocompletePast.bind(this)\r\n          );\r\n          this._isMounted = false\r\n          $(\".items-counter\").text(response.data.itemsTotal);\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  autocompletePast = () => {\r\n    if (this.state.cart.personalData !== undefined) {\r\n      console.log(this.state.cart.personalData.firstName);\r\n      $('.checkout__form__name input[name=\"fname\"]').val(\r\n        this.state.cart.personalData.firstName\r\n      );\r\n      $('.checkout__form__surname input[name=\"lname\"]').val(\r\n        this.state.cart.personalData.lastName\r\n      );\r\n      $('.checkout__form__email input[name=\"email\"]').val(\r\n        this.state.cart.personalData.email\r\n      );\r\n      $('.checkout__form__phone input[name=\"phone\"]').val(\r\n        this.state.cart.personalData.phone\r\n      );\r\n      $('.checkout__form__country input[name=\"country\"]').val(\r\n        this.state.cart.personalData.country\r\n      );\r\n      $('.checkout__form__code input[name=\"postal-code\"]').val(\r\n        this.state.cart.personalData.postalCode\r\n      );\r\n      $('.checkout__form__city input[name=\"address-level2\"]').val(\r\n        this.state.cart.personalData.city\r\n      );\r\n      $('.checkout__form__address-line1 input[name=\"address-line1\"]').val(\r\n        this.state.cart.personalData.addressLine1\r\n      );\r\n      $('.checkout__form__address-line2 input[name=\"address-line2\"]').val(\r\n        this.state.cart.personalData.addressLine2\r\n      );\r\n    }\r\n\r\n    if (this.state.cart.shippingDetails !== undefined && this.state.step == \"2\") { \r\n      document.querySelector(`input[value=\"${this.state.cart.shippingDetails.method}\"`).click()\r\n      if (this.state.cart.shippingDetails.method !== \"Parcel Locker InPost\")  {\r\n        for (var i = 0; i < this.state.cart.shippingDetails.address.split(\",\").length; i++) { \r\n          document.querySelectorAll(\".else input\")[i].value = this.state.cart.shippingDetails.address.split(\",\")[i]\r\n        }\r\n      } else {\r\n        for (var i = 0; i < this.state.cart.shippingDetails.address.split(\",\").length; i++) { \r\n\r\n          document.querySelectorAll(\".inpost input\")[i].value = this.state.cart.shippingDetails.address.split(\",\")[i]\r\n        }\r\n      }\r\n      \r\n    }\r\n  };\r\n\r\n  handleShipAddressToggle = () => {\r\n    if ($(\".switch input\").is(\":checked\")) {\r\n      $('.checkout__form__shipping__country input[name=\"country\"]').val(\r\n        this.state.cart.personalData.country\r\n      );\r\n      $('.checkout__form__shipping__code input[name=\"postal-code\"]').val(\r\n        this.state.cart.personalData.postalCode\r\n      );\r\n      $('.checkout__form__shipping__city input[name=\"address-level2\"]').val(\r\n        this.state.cart.personalData.city\r\n      );\r\n      $(\r\n        '.checkout__form__shipping__address-line1 input[name=\"address-line1\"]'\r\n      ).val(this.state.cart.personalData.addressLine1);\r\n      $(\r\n        '.checkout__form__shipping__address-line2 input[name=\"address-line2\"]'\r\n      ).val(this.state.cart.personalData.addressLine2);\r\n    } else {\r\n      $('.checkout__form__shipping__country input[name=\"country\"]').val(\"\");\r\n      $('.checkout__form__shipping__code input[name=\"postal-code\"]').val(\"\");\r\n      $('.checkout__form__shipping__city input[name=\"address-level2\"]').val(\"\");\r\n      $(\r\n        '.checkout__form__shipping__address-line1 input[name=\"address-line1\"]'\r\n      ).val(\"\");\r\n      $(\r\n        '.checkout__form__shipping__address-line2 input[name=\"address-line2\"]'\r\n      ).val(\"\");\r\n    }\r\n  };\r\n\r\n  postPersonalData = () => {\r\n    axios\r\n      .post(\"/api/cart/post-personal-data\", {\r\n        id: this.state.cart._id,\r\n        firstName: $('input[name=\"fname\"]').val(),\r\n        lastName: $('input[name=\"lname\"]').val(),\r\n        email: $('input[name=\"email\"]').val(),\r\n        phone: $('input[name=\"phone\"]').val(),\r\n        country: $('input[name=\"country\"]').val(),\r\n        postalCode: $('input[name=\"postal-code\"]').val(),\r\n        city: $('input[name=\"address-level2\"]').val(),\r\n        addressLine1: $('input[name=\"address-line1\"]').val(),\r\n        addressLine2: $('input[name=\"address-line2\"]').val(),\r\n      })\r\n      .then((response) => {\r\n        console.log(response.data);\r\n        console.log(this.state.cart._id);\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  postShippingData = () => {\r\n    let elseInputs = [];\r\n    let inpostInputs = [];\r\n\r\n      for (var i = 1; i < document.querySelectorAll(\".else input\").length; i++) { \r\n        elseInputs.push(document.querySelectorAll(\".else input\")[i].value)\r\n      }\r\n\r\n      for (var i = 0; i < document.querySelectorAll(\".inpost input\").length; i++) { \r\n      inpostInputs.push(document.querySelectorAll(\".inpost input\")[i].value)\r\n      }\r\n\r\n    axios\r\n      .post(\"/api/cart/post-shipping-data\", {\r\n        id: this.state.cart._id,\r\n        method: $(\"input[name='delivery']:checked\").val(),\r\n        address:\r\n          document.querySelector('input[value=\"Parcel Locker InPost\"]')\r\n            .checked == true\r\n            ? inpostInputs.join(\", \")\r\n            : elseInputs.join(\", \"),\r\n        price: $(\"input[name='delivery']:checked\").parent().next().next().text().slice(0, $(\"input[name='delivery']:checked\").parent().next().next().text().length - 4),\r\n      })\r\n      .then((response) => {\r\n        console.log(response.data);\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  finalizePurchase = () => {\r\n    this.postPaymentData()\r\n    sessionStorage.clear()\r\n    \r\n  }\r\n\r\n  emptyCart = () => {\r\n    this._isMounted = true;\r\n\r\n    axios\r\n      .delete(\"/api/cart/empty-cart\")\r\n      .then((response) => {\r\n        if (response.data != null && response.data < 1) {\r\n          response.data = response.data;\r\n        } else {\r\n          response.data = false;\r\n        }\r\n\r\n        this.setState({\r\n          cart: response.data,\r\n        });\r\n        $(\".items-counter\").text(response.data.itemsTotal);\r\n\r\n        console.log(response);\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n\r\n    console.log(\"empty clicked\");\r\n  };\r\n\r\n  postPaymentData = () => {\r\n    axios\r\n      .post(\"/api/cart/post-payment-data\", {\r\n        id: this.state.cart._id,\r\n        method: $(\"input[name='payment']:checked\").val(),\r\n      })\r\n      .then((response) => {\r\n        console.log(response.data);\r\n        this.postCart()\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  postCart = () => {\r\n    axios\r\n      .post(\"/api/cart/post-cart-db\")\r\n      .then((response) => {\r\n        if (this._isMounted) {\r\n          this.setState({\r\n            cart: response.data,\r\n          }, $(\".items-counter\").text(response.data.itemsTotal));\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  render() {\r\n    const CartMapping = () => {\r\n      let cart = {};\r\n\r\n      if (this.state.cart != null && this.state.cart.length < 1) {\r\n        this.state.cart = false;\r\n      }\r\n\r\n      if (this.state.cart) {\r\n        cart = this.state.cart.items.map((item) => (\r\n          <li key={item.productId + item.size}>\r\n            <div className=\"cart__info\">\r\n              <h2 className=\"cart__info__name\">{item.productName}</h2>\r\n              <h3 className=\"cart__info__desc\">\r\n                Model: {item.model}, Size: {item.size}\r\n              </h3>\r\n            </div>\r\n\r\n            <h2 className=\"cart__items\">\r\n              {item.quantity > 1\r\n                ? item.quantity + \" items\"\r\n                : item.quantity + \" item\"}\r\n            </h2>\r\n\r\n            <h2 className=\"cart__total\">{item.price} PLN</h2>\r\n            <div className=\"cart__line\"></div>\r\n          </li>\r\n        ));\r\n      } else {\r\n        cart = (\r\n          <li className=\"cart-container__table__products__item__line__empty\">\r\n            The cart is empty\r\n          </li>\r\n        );\r\n      }\r\n\r\n      return cart;\r\n    };\r\n\r\n    const RenderInputInfo = (props) => {\r\n      if (this.state.cart != null && this.state.cart.length < 1) {\r\n        this.state.cart = false;\r\n      }\r\n\r\n      if (this.state.cart) {\r\n        if (props.inputSection == \"1\") {\r\n\r\n          if (this.state.cart.personalData) {\r\n\r\n          return (\r\n            <div className=\"past\">\r\n              <NavLink className=\"checkout__edit\" to=\"/shop/cart/checkout/1\">\r\n                <h3>Edit</h3>\r\n              </NavLink>\r\n              <h3>\r\n                {this.state.cart.personalData.firstName +\r\n                  \" \" +\r\n                  this.state.cart.personalData.lastName}{\" \"}\r\n              </h3>\r\n              <h3>Email: {this.state.cart.personalData.email}</h3>\r\n              <h3>Phone: {this.state.cart.personalData.phone}</h3>\r\n              <h3>\r\n                Address:{\" \"}\r\n                {this.state.cart.personalData.city +\r\n                  \" \" +\r\n                  this.state.cart.personalData.postalCode +\r\n                  \", \" +\r\n                  this.state.cart.personalData.addressLine1 +\r\n                  \" \" +\r\n                  this.state.cart.personalData.addressLine2 +\r\n                  \", \" +\r\n                  this.state.cart.personalData.country}\r\n              </h3>\r\n            </div>\r\n          );\r\n        } else {return <div></div>}\r\n        } else if (props.inputSection == \"2\") {\r\n          if (this.state.cart.shippingDetails) {\r\n          return (\r\n            <div className=\"past\">\r\n              <NavLink className=\"checkout__edit\" to=\"/shop/cart/checkout/2\">\r\n                <h3>Edit</h3>\r\n              </NavLink>\r\n              <h3>Method: {this.state.cart.shippingDetails.method}</h3>\r\n              <h3>Address: {this.state.cart.shippingDetails.address}</h3>\r\n              <h3>Price: {this.state.cart.shippingDetails.price} PLN</h3>\r\n            </div>\r\n          );\r\n          } else {return <div></div>}\r\n        } else {\r\n          return <div>{this.state.cart.personalData.firstName}</div>;\r\n        }\r\n      } else {\r\n        return (\r\n          <li className=\"cart-container__table__products__item__line__empty\">\r\n            The cart is empty\r\n          </li>\r\n        );\r\n      }\r\n    };\r\n\r\n    const InputSection = (props) => {\r\n      if (this.state.step == props.inputSection) {\r\n        return (\r\n          <InputForm\r\n            status={this.state.loginStatus}\r\n            section={\"checkout/\" + this.state.step}\r\n            handler={props.handler}\r\n            shipAddressHandler={this.handleShipAddressToggle}\r\n          >\r\n            {\" \"}\r\n          </InputForm>\r\n        );\r\n      } else if (this.state.step < props.inputSection) {\r\n        return <div></div>;\r\n      } else {\r\n         return <RenderInputInfo inputSection={props.inputSection} />;\r\n      }\r\n    };\r\n\r\n    return (\r\n      <div className=\"checkout\">\r\n        <div className=\"checkout__form\">\r\n          <h1 className=\"checkout__form__title\">checkout</h1>\r\n\r\n          <div\r\n            className={\r\n              \"checkout__form__personal-data \" +\r\n              (this.state.step == \"1\" ? \"active\" : \"\")\r\n            }\r\n          >\r\n            <div className=\"checkout__form__personal-data__tooltip\">\r\n              <h4 className=\"checkout__form__personal-data__title\">\r\n                1. Personal data\r\n              </h4>\r\n            </div>\r\n            <div className=\"checkout__form__personal-data__content\">\r\n              {\r\n                <InputSection\r\n                  handler={this.postPersonalData}\r\n                  inputSection=\"1\"\r\n                />\r\n              }\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            className={\r\n              \"checkout__form__delivery \" +\r\n              (this.state.step == \"2\" ? \"active\" : \"\")\r\n            }\r\n          >\r\n            <div className=\"checkout__form__delivery__tooltip\">\r\n              <h4 className=\"checkout__form__delivery__title\">\r\n                2. Shipping details\r\n              </h4>\r\n            </div>\r\n            <div className=\"checkout__form__delivery__content\">\r\n              {\r\n                <InputSection\r\n                  handler={this.postShippingData}\r\n                  inputSection=\"2\"\r\n                />\r\n              }\r\n            </div>\r\n          </div>\r\n\r\n          <div\r\n            className={\r\n              \"checkout__form__payment \" +\r\n              (this.state.step == \"3\" ? \"active\" : \"\")\r\n            }\r\n          >\r\n            <div className=\"checkout__form__payment__tooltip\">\r\n              <h4 className=\"checkout__form__payment__title\">\r\n                3. Payment method\r\n              </h4>\r\n            </div>\r\n            <div className=\"checkout__form__payment__content\">\r\n              {\r\n                <InputSection\r\n                  handler={this.finalizePurchase}\r\n                  inputSection=\"3\"\r\n                />\r\n              }\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"checkout__summary\">\r\n          <h4 className=\"checkout__summary__title\">Items</h4>\r\n          <ul className=\"checkout__summary__list\">{<CartMapping />}</ul>\r\n          <div className=\"checkout__summary__shipping\">\r\n            <h2 className=\"checkout__summary__shipping__title\">{this.state.cart.shippingDetails ? \"Shipping\" : \"\"}</h2>\r\n\r\n            <h2 className=\"checkout__summary__shipping__value\">\r\n              {this.state.cart.shippingDetails ? (this.state.cart.shippingDetails.price + \"PLN\") : \"\"}{\" \"}\r\n              \r\n            </h2>\r\n          </div>\r\n          <div className=\"checkout__summary__total\">\r\n            <h2 className=\"checkout__summary__total__title\">Total</h2>\r\n            <h2 className=\"checkout__summary__total__items\">\r\n              {this.state.cart.itemsTotal || 0}{\" \"}\r\n              {this.state.cart.itemsTotal == 1 ? \"item\" : \"items\"}\r\n            </h2>\r\n            <h4 className=\"checkout__summary__total__value\">\r\n              {+this.state.cart.subTotal + (this.state.cart.discountTotal || 0) + +(this.state.cart.shippingDetails ? this.state.cart.shippingDetails.price : 0)}{\" \"}\r\n              PLN\r\n            </h4>\r\n          </div>\r\n          <NavLink className=\"checkout__summary__edit\" to=\"shop/cart\">\r\n            <h3>Edit cart</h3>\r\n          </NavLink>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(Checkout);\r\n"]},"metadata":{},"sourceType":"module"}