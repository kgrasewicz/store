{"ast":null,"code":"import _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport React, { useCallback, useRef, useImperativeHandle, useReducer, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport find from 'lodash/find';\nimport FileItem from './UploadFileItem';\nimport UploadTrigger from './UploadTrigger';\nimport { ajaxUpload, useClassNames, useCustom, guid } from '../utils';\nimport Plaintext from '../Plaintext';\nvar defaultProps = {\n  as: 'div',\n  classPrefix: 'uploader',\n  autoUpload: true,\n  timeout: 0,\n  name: 'file',\n  multiple: false,\n  disabled: false,\n  withCredentials: false,\n  data: {},\n  listType: 'text',\n  removable: true,\n  fileListVisible: true\n};\n\nvar getFiles = function getFiles(event) {\n  if (typeof (event === null || event === void 0 ? void 0 : event['dataTransfer']) === 'object') {\n    var _event$dataTransfer;\n\n    return event === null || event === void 0 ? void 0 : (_event$dataTransfer = event['dataTransfer']) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.files;\n  }\n\n  if (event.target) {\n    return event.target['files'];\n  }\n\n  return [];\n};\n\nvar createFile = function createFile(file) {\n  var fileKey = file.fileKey;\n  return _extends({}, file, {\n    fileKey: fileKey || guid(),\n    progress: 0\n  });\n};\n\nfunction fileListReducer(files, action) {\n  var _action$files;\n\n  switch (action.type) {\n    // Add one or more files\n    case 'push':\n      return [].concat(files, action.files);\n    // Remove a file by `fileKey`\n\n    case 'remove':\n      return files.filter(function (f) {\n        return f.fileKey !== action.fileKey;\n      });\n    // Update a file\n\n    case 'updateFile':\n      return files.map(function (file) {\n        return file.fileKey === action.file.fileKey ? action.file : file;\n      });\n    // Initialization file list\n\n    case 'init':\n      return ((_action$files = action.files) === null || _action$files === void 0 ? void 0 : _action$files.map(function (file) {\n        // The state of the file needs to be preserved when the `fileList` is controlled.\n        return files.find(function (f) {\n          return f.fileKey === file.fileKey;\n        }) || createFile(file);\n      })) || [];\n\n    default:\n      throw new Error();\n  }\n}\n\nvar useFileList = function useFileList(defaultFileList) {\n  if (defaultFileList === void 0) {\n    defaultFileList = [];\n  }\n\n  var fileListRef = useRef(defaultFileList.map(createFile));\n  var fileListUpdateCallback = useRef();\n\n  var _useReducer = useReducer(fileListReducer, fileListRef.current),\n      fileList = _useReducer[0],\n      dispatch = _useReducer[1];\n\n  fileListRef.current = fileList;\n  useEffect(function () {\n    var _fileListUpdateCallba;\n\n    (_fileListUpdateCallba = fileListUpdateCallback.current) === null || _fileListUpdateCallba === void 0 ? void 0 : _fileListUpdateCallba.call(fileListUpdateCallback, fileList);\n    fileListUpdateCallback.current = null;\n  }, [fileList]);\n  var dispatchCallback = useCallback(function (action, callback) {\n    dispatch(action);\n    fileListUpdateCallback.current = callback;\n  }, []);\n  return [fileListRef, dispatchCallback];\n};\n\nvar Uploader = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var Component = props.as,\n      classPrefix = props.classPrefix,\n      className = props.className,\n      listType = props.listType,\n      defaultFileList = props.defaultFileList,\n      fileListProp = props.fileList,\n      fileListVisible = props.fileListVisible,\n      localeProp = props.locale,\n      style = props.style,\n      draggable = props.draggable,\n      name = props.name,\n      multiple = props.multiple,\n      disabled = props.disabled,\n      readOnly = props.readOnly,\n      plaintext = props.plaintext,\n      accept = props.accept,\n      children = props.children,\n      toggleAs = props.toggleAs,\n      removable = props.removable,\n      disabledFileItem = props.disabledFileItem,\n      maxPreviewFileSize = props.maxPreviewFileSize,\n      autoUpload = props.autoUpload,\n      action = props.action,\n      headers = props.headers,\n      withCredentials = props.withCredentials,\n      timeout = props.timeout,\n      data = props.data,\n      onRemove = props.onRemove,\n      onUpload = props.onUpload,\n      shouldUpload = props.shouldUpload,\n      shouldQueueUpdate = props.shouldQueueUpdate,\n      renderFileInfo = props.renderFileInfo,\n      onPreview = props.onPreview,\n      onChange = props.onChange,\n      onSuccess = props.onSuccess,\n      onError = props.onError,\n      onProgress = props.onProgress,\n      onReupload = props.onReupload,\n      rest = _objectWithoutPropertiesLoose(props, [\"as\", \"classPrefix\", \"className\", \"listType\", \"defaultFileList\", \"fileList\", \"fileListVisible\", \"locale\", \"style\", \"draggable\", \"name\", \"multiple\", \"disabled\", \"readOnly\", \"plaintext\", \"accept\", \"children\", \"toggleAs\", \"removable\", \"disabledFileItem\", \"maxPreviewFileSize\", \"autoUpload\", \"action\", \"headers\", \"withCredentials\", \"timeout\", \"data\", \"onRemove\", \"onUpload\", \"shouldUpload\", \"shouldQueueUpdate\", \"renderFileInfo\", \"onPreview\", \"onChange\", \"onSuccess\", \"onError\", \"onProgress\", \"onReupload\"]);\n\n  var _useClassNames = useClassNames(classPrefix),\n      merge = _useClassNames.merge,\n      withClassPrefix = _useClassNames.withClassPrefix,\n      prefix = _useClassNames.prefix;\n\n  var classes = merge(className, withClassPrefix(listType, {\n    draggable: draggable\n  }));\n\n  var _useCustom = useCustom('Uploader', localeProp),\n      locale = _useCustom.locale;\n\n  var rootRef = useRef();\n  var xhrs = useRef({});\n  var trigger = useRef();\n\n  var _useFileList = useFileList(fileListProp || defaultFileList),\n      fileList = _useFileList[0],\n      dispatch = _useFileList[1];\n\n  useEffect(function () {\n    if (typeof fileListProp !== 'undefined') {\n      // Force reset fileList in reducer, when `fileListProp` is updated\n      dispatch({\n        type: 'init',\n        files: fileListProp\n      });\n    }\n  }, [dispatch, fileListProp]);\n  var updateFileStatus = useCallback(function (nextFile) {\n    dispatch({\n      type: 'updateFile',\n      file: nextFile\n    });\n  }, [dispatch]);\n  /**\n   * Clear the value in input.\n   */\n\n  var cleanInputValue = useCallback(function () {\n    trigger.current.clearInput();\n  }, []);\n  /**\n   * Callback for successful file upload.\n   * @param file\n   * @param response\n   * @param event\n   * @param xhr\n   */\n\n  var handleAjaxUploadSuccess = useCallback(function (file, response, event, xhr) {\n    var nextFile = _extends({}, file, {\n      status: 'finished',\n      progress: 100\n    });\n\n    updateFileStatus(nextFile);\n    onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(response, nextFile, event, xhr);\n  }, [onSuccess, updateFileStatus]);\n  /**\n   * Callback for file upload error.\n   * @param file\n   * @param status\n   * @param event\n   * @param xhr\n   */\n\n  var handleAjaxUploadError = useCallback(function (file, status, event, xhr) {\n    var nextFile = _extends({}, file, {\n      status: 'error'\n    });\n\n    updateFileStatus(nextFile);\n    onError === null || onError === void 0 ? void 0 : onError(status, nextFile, event, xhr);\n  }, [onError, updateFileStatus]);\n  /**\n   * Callback for file upload progress update.\n   * @param file\n   * @param percent\n   * @param event\n   * @param xhr\n   */\n\n  var handleAjaxUploadProgress = useCallback(function (file, percent, event, xhr) {\n    var nextFile = _extends({}, file, {\n      status: 'uploading',\n      progress: percent\n    });\n\n    updateFileStatus(nextFile);\n    onProgress === null || onProgress === void 0 ? void 0 : onProgress(percent, nextFile, event, xhr);\n  }, [onProgress, updateFileStatus]);\n  /**\n   * Upload a single file.\n   * @param file\n   */\n\n  var handleUploadFile = useCallback(function (file) {\n    var xhr = ajaxUpload({\n      name: name,\n      timeout: timeout,\n      headers: headers,\n      data: data,\n      withCredentials: withCredentials,\n      file: file.blobFile,\n      url: action,\n      onError: handleAjaxUploadError.bind(null, file),\n      onSuccess: handleAjaxUploadSuccess.bind(null, file),\n      onProgress: handleAjaxUploadProgress.bind(null, file)\n    });\n    updateFileStatus(_extends({}, file, {\n      status: 'uploading'\n    }));\n    xhrs.current[file.fileKey] = xhr;\n    onUpload === null || onUpload === void 0 ? void 0 : onUpload(file);\n  }, [action, data, handleAjaxUploadError, handleAjaxUploadProgress, handleAjaxUploadSuccess, headers, name, onUpload, timeout, updateFileStatus, withCredentials]);\n  var handleAjaxUpload = useCallback(function () {\n    fileList.current.forEach(function (file) {\n      var checkState = shouldUpload === null || shouldUpload === void 0 ? void 0 : shouldUpload(file);\n\n      if (checkState instanceof Promise) {\n        checkState.then(function (res) {\n          if (res) {\n            handleUploadFile(file);\n          }\n        });\n        return;\n      } else if (checkState === false) {\n        return;\n      }\n\n      if (file.status === 'inited') {\n        handleUploadFile(file);\n      }\n    });\n    cleanInputValue();\n  }, [cleanInputValue, fileList, handleUploadFile, shouldUpload]);\n\n  var handleUploadTriggerChange = function handleUploadTriggerChange(event) {\n    var files = getFiles(event);\n    var newFileList = [];\n    Array.from(files).forEach(function (file) {\n      newFileList.push({\n        blobFile: file,\n        name: file.name,\n        status: 'inited',\n        fileKey: guid()\n      });\n    });\n    var nextFileList = [].concat(fileList.current, newFileList);\n    var checkState = shouldQueueUpdate === null || shouldQueueUpdate === void 0 ? void 0 : shouldQueueUpdate(nextFileList, newFileList);\n\n    if (checkState === false) {\n      cleanInputValue();\n      return;\n    }\n\n    var upload = function upload() {\n      onChange === null || onChange === void 0 ? void 0 : onChange(nextFileList);\n      dispatch({\n        type: 'push',\n        files: newFileList\n      }, function () {\n        autoUpload && handleAjaxUpload();\n      });\n    };\n\n    if (checkState instanceof Promise) {\n      checkState.then(function (res) {\n        res && upload();\n      });\n      return;\n    }\n\n    upload();\n  };\n\n  var handleRemoveFile = function handleRemoveFile(fileKey) {\n    var _xhrs$current, _xhrs$current$file$fi;\n\n    var file = find(fileList.current, function (f) {\n      return f.fileKey === fileKey;\n    });\n    var nextFileList = fileList.current.filter(function (f) {\n      return f.fileKey !== fileKey;\n    });\n\n    if (((_xhrs$current = xhrs.current) === null || _xhrs$current === void 0 ? void 0 : (_xhrs$current$file$fi = _xhrs$current[file.fileKey]) === null || _xhrs$current$file$fi === void 0 ? void 0 : _xhrs$current$file$fi.readyState) !== 4) {\n      var _xhrs$current$file$fi2;\n\n      (_xhrs$current$file$fi2 = xhrs.current[file.fileKey]) === null || _xhrs$current$file$fi2 === void 0 ? void 0 : _xhrs$current$file$fi2.abort();\n    }\n\n    dispatch({\n      type: 'remove',\n      fileKey: fileKey\n    });\n    onRemove === null || onRemove === void 0 ? void 0 : onRemove(file);\n    onChange === null || onChange === void 0 ? void 0 : onChange(nextFileList);\n    cleanInputValue();\n  };\n\n  var handleReupload = function handleReupload(file) {\n    autoUpload && handleUploadFile(file);\n    onReupload === null || onReupload === void 0 ? void 0 : onReupload(file);\n  }; // public API\n\n\n  var start = function start(file) {\n    if (file) {\n      handleUploadFile(file);\n      return;\n    }\n\n    handleAjaxUpload();\n  };\n\n  useImperativeHandle(ref, function () {\n    return {\n      root: rootRef.current,\n      start: start\n    };\n  });\n  var renderList = [/*#__PURE__*/React.createElement(UploadTrigger, _extends({}, rest, {\n    locale: locale,\n    name: name,\n    key: \"trigger\",\n    multiple: multiple,\n    draggable: draggable,\n    disabled: disabled,\n    readOnly: readOnly,\n    accept: accept,\n    ref: trigger,\n    onChange: handleUploadTriggerChange,\n    as: toggleAs\n  }), children)];\n\n  if (fileListVisible) {\n    renderList.push( /*#__PURE__*/React.createElement(\"div\", {\n      key: \"items\",\n      className: prefix('file-items')\n    }, fileList.current.map(function (file, index) {\n      return /*#__PURE__*/React.createElement(FileItem, {\n        locale: locale,\n        key: file.fileKey || index,\n        file: file,\n        maxPreviewFileSize: maxPreviewFileSize,\n        listType: listType,\n        disabled: disabledFileItem,\n        onPreview: onPreview,\n        onReupload: handleReupload,\n        onCancel: handleRemoveFile,\n        renderFileInfo: renderFileInfo,\n        removable: removable && !readOnly && !plaintext,\n        allowReupload: !readOnly && !plaintext\n      });\n    })));\n  }\n\n  if (plaintext) {\n    return /*#__PURE__*/React.createElement(Plaintext, {\n      localeKey: \"notUploaded\",\n      className: withClassPrefix(listType)\n    }, fileList.current.length ? renderList[1] : null);\n  }\n\n  if (listType === 'picture') {\n    renderList.reverse();\n  }\n\n  return /*#__PURE__*/React.createElement(Component, {\n    ref: rootRef,\n    className: classes,\n    style: style\n  }, renderList);\n});\nUploader.displayName = 'Uploader';\nUploader.defaultProps = defaultProps;\nUploader.propTypes = {\n  action: PropTypes.string,\n  accept: PropTypes.string,\n  autoUpload: PropTypes.bool,\n  children: PropTypes.node,\n  className: PropTypes.string,\n  classPrefix: PropTypes.string,\n  defaultFileList: PropTypes.array,\n  fileList: PropTypes.array,\n  data: PropTypes.object,\n  multiple: PropTypes.bool,\n  disabled: PropTypes.bool,\n  disabledFileItem: PropTypes.bool,\n  name: PropTypes.string,\n  timeout: PropTypes.number,\n  withCredentials: PropTypes.bool,\n  headers: PropTypes.object,\n  locale: PropTypes.any,\n  listType: PropTypes.oneOf(['text', 'picture-text', 'picture']),\n  shouldQueueUpdate: PropTypes.func,\n  shouldUpload: PropTypes.func,\n  onChange: PropTypes.func,\n  onUpload: PropTypes.func,\n  onReupload: PropTypes.func,\n  onPreview: PropTypes.func,\n  onError: PropTypes.func,\n  onSuccess: PropTypes.func,\n  onProgress: PropTypes.func,\n  onRemove: PropTypes.func,\n  maxPreviewFileSize: PropTypes.number,\n  style: PropTypes.object,\n  toggleAs: PropTypes.elementType,\n  renderFileInfo: PropTypes.func,\n  removable: PropTypes.bool,\n  fileListVisible: PropTypes.bool,\n  draggable: PropTypes.bool\n};\nexport default Uploader;","map":{"version":3,"sources":["C:/Programowanie/store/node_modules/rsuite/es/Uploader/Uploader.js"],"names":["_objectWithoutPropertiesLoose","_extends","React","useCallback","useRef","useImperativeHandle","useReducer","useEffect","PropTypes","find","FileItem","UploadTrigger","ajaxUpload","useClassNames","useCustom","guid","Plaintext","defaultProps","as","classPrefix","autoUpload","timeout","name","multiple","disabled","withCredentials","data","listType","removable","fileListVisible","getFiles","event","_event$dataTransfer","files","target","createFile","file","fileKey","progress","fileListReducer","action","_action$files","type","concat","filter","f","map","Error","useFileList","defaultFileList","fileListRef","fileListUpdateCallback","_useReducer","current","fileList","dispatch","_fileListUpdateCallba","call","dispatchCallback","callback","Uploader","forwardRef","props","ref","Component","className","fileListProp","localeProp","locale","style","draggable","readOnly","plaintext","accept","children","toggleAs","disabledFileItem","maxPreviewFileSize","headers","onRemove","onUpload","shouldUpload","shouldQueueUpdate","renderFileInfo","onPreview","onChange","onSuccess","onError","onProgress","onReupload","rest","_useClassNames","merge","withClassPrefix","prefix","classes","_useCustom","rootRef","xhrs","trigger","_useFileList","updateFileStatus","nextFile","cleanInputValue","clearInput","handleAjaxUploadSuccess","response","xhr","status","handleAjaxUploadError","handleAjaxUploadProgress","percent","handleUploadFile","blobFile","url","bind","handleAjaxUpload","forEach","checkState","Promise","then","res","handleUploadTriggerChange","newFileList","Array","from","push","nextFileList","upload","handleRemoveFile","_xhrs$current","_xhrs$current$file$fi","readyState","_xhrs$current$file$fi2","abort","handleReupload","start","root","renderList","createElement","key","index","onCancel","allowReupload","localeKey","length","reverse","displayName","propTypes","string","bool","node","array","object","number","any","oneOf","func","elementType"],"mappings":"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","sourcesContent":["import _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport React, { useCallback, useRef, useImperativeHandle, useReducer, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport find from 'lodash/find';\nimport FileItem from './UploadFileItem';\nimport UploadTrigger from './UploadTrigger';\nimport { ajaxUpload, useClassNames, useCustom, guid } from '../utils';\nimport Plaintext from '../Plaintext';\nvar defaultProps = {\n  as: 'div',\n  classPrefix: 'uploader',\n  autoUpload: true,\n  timeout: 0,\n  name: 'file',\n  multiple: false,\n  disabled: false,\n  withCredentials: false,\n  data: {},\n  listType: 'text',\n  removable: true,\n  fileListVisible: true\n};\n\nvar getFiles = function getFiles(event) {\n  if (typeof (event === null || event === void 0 ? void 0 : event['dataTransfer']) === 'object') {\n    var _event$dataTransfer;\n\n    return event === null || event === void 0 ? void 0 : (_event$dataTransfer = event['dataTransfer']) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.files;\n  }\n\n  if (event.target) {\n    return event.target['files'];\n  }\n\n  return [];\n};\n\nvar createFile = function createFile(file) {\n  var fileKey = file.fileKey;\n  return _extends({}, file, {\n    fileKey: fileKey || guid(),\n    progress: 0\n  });\n};\n\nfunction fileListReducer(files, action) {\n  var _action$files;\n\n  switch (action.type) {\n    // Add one or more files\n    case 'push':\n      return [].concat(files, action.files);\n    // Remove a file by `fileKey`\n\n    case 'remove':\n      return files.filter(function (f) {\n        return f.fileKey !== action.fileKey;\n      });\n    // Update a file\n\n    case 'updateFile':\n      return files.map(function (file) {\n        return file.fileKey === action.file.fileKey ? action.file : file;\n      });\n    // Initialization file list\n\n    case 'init':\n      return ((_action$files = action.files) === null || _action$files === void 0 ? void 0 : _action$files.map(function (file) {\n        // The state of the file needs to be preserved when the `fileList` is controlled.\n        return files.find(function (f) {\n          return f.fileKey === file.fileKey;\n        }) || createFile(file);\n      })) || [];\n\n    default:\n      throw new Error();\n  }\n}\n\nvar useFileList = function useFileList(defaultFileList) {\n  if (defaultFileList === void 0) {\n    defaultFileList = [];\n  }\n\n  var fileListRef = useRef(defaultFileList.map(createFile));\n  var fileListUpdateCallback = useRef();\n\n  var _useReducer = useReducer(fileListReducer, fileListRef.current),\n      fileList = _useReducer[0],\n      dispatch = _useReducer[1];\n\n  fileListRef.current = fileList;\n  useEffect(function () {\n    var _fileListUpdateCallba;\n\n    (_fileListUpdateCallba = fileListUpdateCallback.current) === null || _fileListUpdateCallba === void 0 ? void 0 : _fileListUpdateCallba.call(fileListUpdateCallback, fileList);\n    fileListUpdateCallback.current = null;\n  }, [fileList]);\n  var dispatchCallback = useCallback(function (action, callback) {\n    dispatch(action);\n    fileListUpdateCallback.current = callback;\n  }, []);\n  return [fileListRef, dispatchCallback];\n};\n\nvar Uploader = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var Component = props.as,\n      classPrefix = props.classPrefix,\n      className = props.className,\n      listType = props.listType,\n      defaultFileList = props.defaultFileList,\n      fileListProp = props.fileList,\n      fileListVisible = props.fileListVisible,\n      localeProp = props.locale,\n      style = props.style,\n      draggable = props.draggable,\n      name = props.name,\n      multiple = props.multiple,\n      disabled = props.disabled,\n      readOnly = props.readOnly,\n      plaintext = props.plaintext,\n      accept = props.accept,\n      children = props.children,\n      toggleAs = props.toggleAs,\n      removable = props.removable,\n      disabledFileItem = props.disabledFileItem,\n      maxPreviewFileSize = props.maxPreviewFileSize,\n      autoUpload = props.autoUpload,\n      action = props.action,\n      headers = props.headers,\n      withCredentials = props.withCredentials,\n      timeout = props.timeout,\n      data = props.data,\n      onRemove = props.onRemove,\n      onUpload = props.onUpload,\n      shouldUpload = props.shouldUpload,\n      shouldQueueUpdate = props.shouldQueueUpdate,\n      renderFileInfo = props.renderFileInfo,\n      onPreview = props.onPreview,\n      onChange = props.onChange,\n      onSuccess = props.onSuccess,\n      onError = props.onError,\n      onProgress = props.onProgress,\n      onReupload = props.onReupload,\n      rest = _objectWithoutPropertiesLoose(props, [\"as\", \"classPrefix\", \"className\", \"listType\", \"defaultFileList\", \"fileList\", \"fileListVisible\", \"locale\", \"style\", \"draggable\", \"name\", \"multiple\", \"disabled\", \"readOnly\", \"plaintext\", \"accept\", \"children\", \"toggleAs\", \"removable\", \"disabledFileItem\", \"maxPreviewFileSize\", \"autoUpload\", \"action\", \"headers\", \"withCredentials\", \"timeout\", \"data\", \"onRemove\", \"onUpload\", \"shouldUpload\", \"shouldQueueUpdate\", \"renderFileInfo\", \"onPreview\", \"onChange\", \"onSuccess\", \"onError\", \"onProgress\", \"onReupload\"]);\n\n  var _useClassNames = useClassNames(classPrefix),\n      merge = _useClassNames.merge,\n      withClassPrefix = _useClassNames.withClassPrefix,\n      prefix = _useClassNames.prefix;\n\n  var classes = merge(className, withClassPrefix(listType, {\n    draggable: draggable\n  }));\n\n  var _useCustom = useCustom('Uploader', localeProp),\n      locale = _useCustom.locale;\n\n  var rootRef = useRef();\n  var xhrs = useRef({});\n  var trigger = useRef();\n\n  var _useFileList = useFileList(fileListProp || defaultFileList),\n      fileList = _useFileList[0],\n      dispatch = _useFileList[1];\n\n  useEffect(function () {\n    if (typeof fileListProp !== 'undefined') {\n      // Force reset fileList in reducer, when `fileListProp` is updated\n      dispatch({\n        type: 'init',\n        files: fileListProp\n      });\n    }\n  }, [dispatch, fileListProp]);\n  var updateFileStatus = useCallback(function (nextFile) {\n    dispatch({\n      type: 'updateFile',\n      file: nextFile\n    });\n  }, [dispatch]);\n  /**\n   * Clear the value in input.\n   */\n\n  var cleanInputValue = useCallback(function () {\n    trigger.current.clearInput();\n  }, []);\n  /**\n   * Callback for successful file upload.\n   * @param file\n   * @param response\n   * @param event\n   * @param xhr\n   */\n\n  var handleAjaxUploadSuccess = useCallback(function (file, response, event, xhr) {\n    var nextFile = _extends({}, file, {\n      status: 'finished',\n      progress: 100\n    });\n\n    updateFileStatus(nextFile);\n    onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(response, nextFile, event, xhr);\n  }, [onSuccess, updateFileStatus]);\n  /**\n   * Callback for file upload error.\n   * @param file\n   * @param status\n   * @param event\n   * @param xhr\n   */\n\n  var handleAjaxUploadError = useCallback(function (file, status, event, xhr) {\n    var nextFile = _extends({}, file, {\n      status: 'error'\n    });\n\n    updateFileStatus(nextFile);\n    onError === null || onError === void 0 ? void 0 : onError(status, nextFile, event, xhr);\n  }, [onError, updateFileStatus]);\n  /**\n   * Callback for file upload progress update.\n   * @param file\n   * @param percent\n   * @param event\n   * @param xhr\n   */\n\n  var handleAjaxUploadProgress = useCallback(function (file, percent, event, xhr) {\n    var nextFile = _extends({}, file, {\n      status: 'uploading',\n      progress: percent\n    });\n\n    updateFileStatus(nextFile);\n    onProgress === null || onProgress === void 0 ? void 0 : onProgress(percent, nextFile, event, xhr);\n  }, [onProgress, updateFileStatus]);\n  /**\n   * Upload a single file.\n   * @param file\n   */\n\n  var handleUploadFile = useCallback(function (file) {\n    var xhr = ajaxUpload({\n      name: name,\n      timeout: timeout,\n      headers: headers,\n      data: data,\n      withCredentials: withCredentials,\n      file: file.blobFile,\n      url: action,\n      onError: handleAjaxUploadError.bind(null, file),\n      onSuccess: handleAjaxUploadSuccess.bind(null, file),\n      onProgress: handleAjaxUploadProgress.bind(null, file)\n    });\n    updateFileStatus(_extends({}, file, {\n      status: 'uploading'\n    }));\n    xhrs.current[file.fileKey] = xhr;\n    onUpload === null || onUpload === void 0 ? void 0 : onUpload(file);\n  }, [action, data, handleAjaxUploadError, handleAjaxUploadProgress, handleAjaxUploadSuccess, headers, name, onUpload, timeout, updateFileStatus, withCredentials]);\n  var handleAjaxUpload = useCallback(function () {\n    fileList.current.forEach(function (file) {\n      var checkState = shouldUpload === null || shouldUpload === void 0 ? void 0 : shouldUpload(file);\n\n      if (checkState instanceof Promise) {\n        checkState.then(function (res) {\n          if (res) {\n            handleUploadFile(file);\n          }\n        });\n        return;\n      } else if (checkState === false) {\n        return;\n      }\n\n      if (file.status === 'inited') {\n        handleUploadFile(file);\n      }\n    });\n    cleanInputValue();\n  }, [cleanInputValue, fileList, handleUploadFile, shouldUpload]);\n\n  var handleUploadTriggerChange = function handleUploadTriggerChange(event) {\n    var files = getFiles(event);\n    var newFileList = [];\n    Array.from(files).forEach(function (file) {\n      newFileList.push({\n        blobFile: file,\n        name: file.name,\n        status: 'inited',\n        fileKey: guid()\n      });\n    });\n    var nextFileList = [].concat(fileList.current, newFileList);\n    var checkState = shouldQueueUpdate === null || shouldQueueUpdate === void 0 ? void 0 : shouldQueueUpdate(nextFileList, newFileList);\n\n    if (checkState === false) {\n      cleanInputValue();\n      return;\n    }\n\n    var upload = function upload() {\n      onChange === null || onChange === void 0 ? void 0 : onChange(nextFileList);\n      dispatch({\n        type: 'push',\n        files: newFileList\n      }, function () {\n        autoUpload && handleAjaxUpload();\n      });\n    };\n\n    if (checkState instanceof Promise) {\n      checkState.then(function (res) {\n        res && upload();\n      });\n      return;\n    }\n\n    upload();\n  };\n\n  var handleRemoveFile = function handleRemoveFile(fileKey) {\n    var _xhrs$current, _xhrs$current$file$fi;\n\n    var file = find(fileList.current, function (f) {\n      return f.fileKey === fileKey;\n    });\n    var nextFileList = fileList.current.filter(function (f) {\n      return f.fileKey !== fileKey;\n    });\n\n    if (((_xhrs$current = xhrs.current) === null || _xhrs$current === void 0 ? void 0 : (_xhrs$current$file$fi = _xhrs$current[file.fileKey]) === null || _xhrs$current$file$fi === void 0 ? void 0 : _xhrs$current$file$fi.readyState) !== 4) {\n      var _xhrs$current$file$fi2;\n\n      (_xhrs$current$file$fi2 = xhrs.current[file.fileKey]) === null || _xhrs$current$file$fi2 === void 0 ? void 0 : _xhrs$current$file$fi2.abort();\n    }\n\n    dispatch({\n      type: 'remove',\n      fileKey: fileKey\n    });\n    onRemove === null || onRemove === void 0 ? void 0 : onRemove(file);\n    onChange === null || onChange === void 0 ? void 0 : onChange(nextFileList);\n    cleanInputValue();\n  };\n\n  var handleReupload = function handleReupload(file) {\n    autoUpload && handleUploadFile(file);\n    onReupload === null || onReupload === void 0 ? void 0 : onReupload(file);\n  }; // public API\n\n\n  var start = function start(file) {\n    if (file) {\n      handleUploadFile(file);\n      return;\n    }\n\n    handleAjaxUpload();\n  };\n\n  useImperativeHandle(ref, function () {\n    return {\n      root: rootRef.current,\n      start: start\n    };\n  });\n  var renderList = [/*#__PURE__*/React.createElement(UploadTrigger, _extends({}, rest, {\n    locale: locale,\n    name: name,\n    key: \"trigger\",\n    multiple: multiple,\n    draggable: draggable,\n    disabled: disabled,\n    readOnly: readOnly,\n    accept: accept,\n    ref: trigger,\n    onChange: handleUploadTriggerChange,\n    as: toggleAs\n  }), children)];\n\n  if (fileListVisible) {\n    renderList.push( /*#__PURE__*/React.createElement(\"div\", {\n      key: \"items\",\n      className: prefix('file-items')\n    }, fileList.current.map(function (file, index) {\n      return /*#__PURE__*/React.createElement(FileItem, {\n        locale: locale,\n        key: file.fileKey || index,\n        file: file,\n        maxPreviewFileSize: maxPreviewFileSize,\n        listType: listType,\n        disabled: disabledFileItem,\n        onPreview: onPreview,\n        onReupload: handleReupload,\n        onCancel: handleRemoveFile,\n        renderFileInfo: renderFileInfo,\n        removable: removable && !readOnly && !plaintext,\n        allowReupload: !readOnly && !plaintext\n      });\n    })));\n  }\n\n  if (plaintext) {\n    return /*#__PURE__*/React.createElement(Plaintext, {\n      localeKey: \"notUploaded\",\n      className: withClassPrefix(listType)\n    }, fileList.current.length ? renderList[1] : null);\n  }\n\n  if (listType === 'picture') {\n    renderList.reverse();\n  }\n\n  return /*#__PURE__*/React.createElement(Component, {\n    ref: rootRef,\n    className: classes,\n    style: style\n  }, renderList);\n});\nUploader.displayName = 'Uploader';\nUploader.defaultProps = defaultProps;\nUploader.propTypes = {\n  action: PropTypes.string,\n  accept: PropTypes.string,\n  autoUpload: PropTypes.bool,\n  children: PropTypes.node,\n  className: PropTypes.string,\n  classPrefix: PropTypes.string,\n  defaultFileList: PropTypes.array,\n  fileList: PropTypes.array,\n  data: PropTypes.object,\n  multiple: PropTypes.bool,\n  disabled: PropTypes.bool,\n  disabledFileItem: PropTypes.bool,\n  name: PropTypes.string,\n  timeout: PropTypes.number,\n  withCredentials: PropTypes.bool,\n  headers: PropTypes.object,\n  locale: PropTypes.any,\n  listType: PropTypes.oneOf(['text', 'picture-text', 'picture']),\n  shouldQueueUpdate: PropTypes.func,\n  shouldUpload: PropTypes.func,\n  onChange: PropTypes.func,\n  onUpload: PropTypes.func,\n  onReupload: PropTypes.func,\n  onPreview: PropTypes.func,\n  onError: PropTypes.func,\n  onSuccess: PropTypes.func,\n  onProgress: PropTypes.func,\n  onRemove: PropTypes.func,\n  maxPreviewFileSize: PropTypes.number,\n  style: PropTypes.object,\n  toggleAs: PropTypes.elementType,\n  renderFileInfo: PropTypes.func,\n  removable: PropTypes.bool,\n  fileListVisible: PropTypes.bool,\n  draggable: PropTypes.bool\n};\nexport default Uploader;"]},"metadata":{},"sourceType":"module"}